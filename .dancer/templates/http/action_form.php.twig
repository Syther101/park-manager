{% extends 'http/action.php.twig' %}

{% block uses %}
use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Symfony\Component\Form\FormFactoryInterface;
use Symfony\Component\HttpFoundation\Request;
use ParkManager\Module\{{ module_name }}\Application\{{ module_section }} as Application;
use ParkManager\SharedKernel\Infrastructure\Symfony\Form\FormHandlerTrait;
{% endblock uses %}

{% block class_content %}
    use FormHandlerTrait;

    public function __invoke(Request $request, string ${{ local_name }}Id)
    {
        $service = $this->get('park_manager.{{ module_alias }}.application.{{ local_name }}.show');
        ${{ local_name }} = $showService->execute(new Application\Service\{{ action_name }}{{ module_section }}Request(${{ local_name }}Id));

        ${{ local_name }} = {{ module_section }}FormModel::fromModel(${{ local_name }});
        // ${{ local_name }} = new {{ module_name }}FormModel();

        $form = $this->createForm({{ module_section }}FormType::class, ${{ local_name }});
        $form->handleRequest($request);

        return $this->handleFormResponse(
            $form,
            function () uses ($form, ${{ local_name }}) {
                $updateService = $this->get('park_manager.{{ module_alias }}.application.{{ local_name }}.update');
                ${{ local_name }} = ${{ local_name }}->toRequest();

                $this->addFlash(
                    'success',
                    $this->get('translator')->trans('park_manager.{{ module_alias }}.{{ module_section }}.updated')
                );

                // $this->addFlash(
                //     'success',
                //     $this->get('translator')->trans('park_manager.{{ module_alias }}.{{ module_section }}.created')
                // );

                return $this->redirectToRoute('park_manager_{{ module_alias }}_{{ module_section }}_list', []);
            },
            function () uses ($form) {
                return $this->render('@ParkManager{{ module_name }}/{{ local_name }}/{{ action_name|lower }}.html.twig', [
                    'form' => $form->createView(),
                ]);
            }
        );
    }
{% endblock class_content %}
